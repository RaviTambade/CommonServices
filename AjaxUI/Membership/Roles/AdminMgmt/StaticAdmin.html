<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roles Management</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        div {
            margin-bottom: 10px;
        }

        label {
            display: inline-block;
            width: 100px;
        }

        input,
        select,
        button {
            padding: 5px;
            margin-left: 10px;
        }

        #roles div {
            margin-top: 5px;
        }

        table,
        th,
        td {
            width: auto;
            border: 1px solid black;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        #roleFormModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        #roleFormModal h3 {
            margin-top: 0;
        }

        #roleFormModal input[type="text"] {
            width: 200px;
        }

        #roleFormModal button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Manage Roles for User and LOB</h2>
    <div>
        <label for="txtUserId">Enter User Id:</label>
        <input type="number" id="txtUserId" />

        <div>
            <label for="ddlob">Select LOB:</label>
            <select id="ddlob">
                <option value="pms">PMS</option>
                <option value="eAgro">EAgro</option>
                <option value="eKrushi">EKrushi</option>
            </select>
        </div>
        
        <div>
            <button id="btngetroles">Get Roles</button>
        </div>
        
        <br />
        <div id="checkboxContainer"></div>
    </div>

    <div>
        <button id="btnAddRole">Add Role</button>
        <button id="btnDeleteRole">Delete Role</button>
        <button id="btnUpdateRole">Update Role</button>
    </div>

    <script>
        $(document).ready(function () {
            const hardcodedRoles = ['Director', 'HR Manager', 'Employee', 'Project Manager', 'Store Incharge', 'Store Manager', 'Store Owner'];
            let currentRoles = [...hardcodedRoles]; // Clone of hardcodedRoles for manipulation

            // Function to fetch roles for a specific user and LOB
            function fetchRoles(userId, lob) {
                console.log(`Fetching roles for User ID: ${userId}, LOB: ${lob}`);
                displayRoles(currentRoles);
            }

            // Function to display roles as checkboxes
            function displayRoles(roles) {
                $('#checkboxContainer').empty();
                roles.forEach(role => {
                    const checkbox = $('<input>').attr({
                        type: 'checkbox',
                        value: role,
                        checked: true // Default checked as per initial fetch
                    });
                    const label = $('<label>').text(role).prepend(checkbox);
                    $('#checkboxContainer').append($('<div>').append(label));

                    // Bind change event to checkboxes
                    checkbox.on('change', function() {
                        const isChecked = $(this).prop('checked');
                        const roleName = $(this).val();

                        if (isChecked) {
                            console.log(`Role added: ${roleName}`);
                        } else {
                            console.log(`Role removed: ${roleName}`);
                        }
                    });
                });
            }

            // Button click event for fetching roles
            $("#btngetroles").click(function () {
                var userId = $("#txtUserId").val();
                var lob = $("#ddlob").val();

                if (userId && lob) {
                    fetchRoles(userId, lob);
                } else {
                    alert("Please enter a User ID and select a LOB.");
                }
            });

            // Function to add a role
            function addRole(role) {
                if (!currentRoles.includes(role)) {
                    currentRoles.push(role);
                    displayRoles(currentRoles);
                    console.log('Role added:', role);
                } else {
                    alert("Role already exists.");
                }
            }

            // Function to delete a role
            function deleteRole(role) {
                const index = currentRoles.indexOf(role);
                if (index !== -1) {
                    currentRoles.splice(index, 1);
                    displayRoles(currentRoles);
                    console.log('Role deleted:', role);
                } else {
                    alert("Role not found.");
                }
            }

            // Function to update a role
            function updateRole({ oldRoleName, newRoleName }) {
                const index = currentRoles.indexOf(oldRoleName);
                if (index !== -1) {
                    currentRoles[index] = newRoleName;
                    displayRoles(currentRoles);
                    console.log('Role updated:', { oldRoleName, newRoleName });
                } else {
                    alert("Role not found.");
                }
            }

            // Bind add role button
            $("#btnAddRole").click(function () {
                const roleName = prompt("Enter role name to add:");
                if (roleName) {
                    addRole(roleName);
                }
            });

            // Bind delete role button
            $("#btnDeleteRole").click(function () {
                const roleName = prompt("Enter role name to delete:");
                if (roleName) {
                    deleteRole(roleName);
                }
            });

            // Bind update role button
            $("#btnUpdateRole").click(function () {
                const oldRoleName = prompt("Enter role name to update:");
                if (oldRoleName) {
                    const newRoleName = prompt("Enter new role name:");
                    if (newRoleName) {
                        updateRole({ oldRoleName, newRoleName });
                    }
                }
            });
        });
    </script>
</body>
</html>
