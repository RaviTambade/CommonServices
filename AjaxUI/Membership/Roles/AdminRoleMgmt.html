<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Roles</title>
    <style>
        table,
        th,
        td {

            width: auto;
            border: 1px solid black;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h2>Get All Roles in Application of User and LOB (Line of Business)</h2>


    <div>
        <label for="">Enter User Id : </label><input id="txtUserId" />

        <div>
            <div>
                <label>Select LOB : </label>
                <select id="ddlob">

                </select>


            </div>
            <div>
                <button id="btngetroles">Get Role</button>
            </div>
            <br />
            <div id="checkboxContainer">
                
            </div>
</body>

<script>
    $(document).ready(function () {
        console.log("Document.Ready");

        $.ajax({
            url: `http://localhost:5000/api/roles/lobs`,
            type: 'GET',
            contentType: 'application/json',
            success: function (data) {
                console.log(data);
                $("#ddlob").append('<option value="">Select LOB</option>');
                data.forEach(function (data) {
                    var option = $('<option></option>').attr("value", data).text(data);
                    $("#ddlob").append(option);
                });
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
                alert("An error occurred while fetching the LOBs. Please try again.");
            }
        });




        $("#btngetroles").click(function () {
            var userId = $("#txtUserId").val();
            //var LOB = $('#ddlob').val();
            var lob =$("#ddlob option:selected").text();
            console.log(lob);
            $.ajax({
                url: "http://localhost:5000/api/roles/users/"+userId+"/lob/"+lob,
                type: 'GET',
                contentType: 'application/json',

                success: function (data) {
                   var userroles =data;
                    data.forEach(addCheckbox);
                    console.log(data);
                   
                },
                error: function (xhr, status, error) {
                    console.error('AJAX Error: ' + status + error);
                }
            });
            
                function addCheckbox(userroles) {
                    $('#checkboxContainer').empty();
                    console.log("Inside chechbox fun");
                    var checkbox = $('<input>').attr({
                        type: 'checkbox',
                        value: userroles.name
                    });
                    var label = $('<label>').text(userroles.name).prepend(checkbox);
                    $('<div>').addClass('checkbox').append(label).appendTo('#checkboxContainer');
                }
            });
        });
</script>

</html>